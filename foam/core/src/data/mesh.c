#include <foam/core/data/mesh.h>
#include <foam/core/ext/logger.h>

void 
fe_mesh_make(fe_mesh_t *mesh)
{
    mesh->verts       = FE_VEC_EMPTY;
    mesh->indices     = FE_VEC_EMPTY;
}

void
fe_mesh_kill(fe_mesh_t *mesh)
{
	fe_vec_kill(mesh->verts, NULL);
	fe_vec_kill(mesh->indices, NULL);
}

fe_mesh_t
fe_mesh_dup(const fe_mesh_t *mesh)
{
    fe_mesh_t m;
    fe_mesh_make(&m);
    fe_vec_append(m.verts, mesh->verts);
    fe_vec_append(m.indices, mesh->indices);

    return m;
}

void
fe_mesh_apply_transform(fe_mesh_t *dst_mesh, const fe_mesh_t *base_mesh, const fe_vec3_t *trl, const fe_quat_t *rot, const fe_vec3_t *scl)
{ 
    for (u64 k = 0; k * 3 < fe_vec_get_count(base_mesh->indices); k++)
    {
        fe_vec3_t v0 = base_mesh->verts[base_mesh->indices[3 * k]].pos;
        fe_vec3_t v1 = base_mesh->verts[base_mesh->indices[3 * k + 1]].pos;
        fe_vec3_t v2 = base_mesh->verts[base_mesh->indices[3 * k + 2]].pos;

        fe_vec3_mul(&v0, scl);
        fe_vec3_mul(&v1, scl);
        fe_vec3_mul(&v2, scl);

        v0 = fe_quat_mul_vec3(rot, &v0);
        v1 = fe_quat_mul_vec3(rot, &v1);
        v2 = fe_quat_mul_vec3(rot, &v2);

        fe_vec3_add(&v0, trl);
        fe_vec3_add(&v1, trl);
        fe_vec3_add(&v2, trl);

        dst_mesh->verts[base_mesh->indices[3 * k]].pos     = v0;
        dst_mesh->verts[base_mesh->indices[3 * k + 1]].pos = v1;
        dst_mesh->verts[base_mesh->indices[3 * k + 2]].pos = v2;
    }
}

void
fe_mesh_print(const fe_mesh_t *mesh)
{
    printf("--- ---\n");
    fe_vec_for_each(mesh->verts, v)
    {
        printf("pos:  "); fe_vec3_print(&v->pos);
        printf("uv:   "); fe_vec2_print(&v->uv);
        printf("norm: "); fe_vec3_print(&v->norm);
        printf("\n");
    }
    fe_vec_for_each(mesh->indices, i)
    {
        printf("%u, ", *i);
    }
    printf("\n");
    printf("--- ---\n");
}

void
fe_mesh_make_plane(fe_mesh_t *plane)
{
    fe_mesh_make(plane);
    fe_vertex_t verts[] = 
    {
        {{{-1.000000, -1.000000, 0.000000}}, {{0.000000, 0.000000}}, {{0.000000, 0.000000, 1.000000}}},
        {{{1.000000,  -1.000000, 0.000000}}, {{1.000000, 0.000000}}, {{0.000000, 0.000000, 1.000000}}},
        {{{1.000000,  1.000000, 0.000000}}, {{1.000000, 1.000000}}, {{0.000000, 0.000000, 1.000000}}},
        {{{-1.000000, 1.000000, 0.000000}}, {{0.000000, 1.000000}}, {{0.000000, 0.000000, 1.000000}}},
    };

    u32 indices[] = {0, 1, 2, 0, 2, 3};
    
    for (u32 i = 0; i < ARRAY_SIZE(verts); i++)
    {
        fe_vertex_t *v = NULL;
        fe_vec_add_and_get(plane->verts, v);
        *v = verts[i];
    }

    for (u32 i = 0; i < ARRAY_SIZE(indices); i++)
    {
        u32 *indice = NULL;
        fe_vec_add_and_get(plane->indices, indice);
        *indice = indices[i];
    }
}

void
fe_mesh_make_cube(fe_mesh_t *cube)
{
    fe_mesh_make(cube);
    fe_vertex_t verts[] = 
    {
        {{{-1.000000, -1.000000, -1.000000}}, {{0.375000, 0.000000}}, {{-1.000000, 0.000000, 0.000000}}},
        {{{-1.000000, -1.000000, 1.000000}},  {{0.625000, 0.000000}}, {{-1.000000, 0.000000, 0.000000}}},
        {{{-1.000000, 1.000000, 1.000000}},   {{0.625000, 0.250000}}, {{-1.000000, 0.000000, 0.000000}}},
        {{{-1.000000, 1.000000, -1.000000}},  {{0.375000, 0.250000}}, {{-1.000000, 0.000000, 0.000000}}},
        {{{-1.000000, 1.000000, -1.000000}},  {{0.375000, 0.250000}}, {{0.000000, 1.000000, 0.000000}}},
        {{{-1.000000, 1.000000, 1.000000}},   {{0.625000, 0.250000}}, {{0.000000, 1.000000, 0.000000}}},
        {{{1.000000, 1.000000, 1.000000}},   {{0.625000, 0.500000}}, {{0.000000, 1.000000, 0.000000}}},
        {{{1.000000, 1.000000, -1.000000}},   {{0.375000, 0.500000}}, {{0.000000, 1.000000, 0.000000}}},
        {{{1.000000, 1.000000, -1.000000}},   {{0.375000, 0.500000}}, {{1.000000, 0.000000, 0.000000}}},
        {{{1.000000, 1.000000, 1.000000}},   {{0.625000, 0.500000}}, {{1.000000, 0.000000, 0.000000}}},
        {{{1.000000, -1.000000, 1.000000}},   {{0.625000, 0.750000}}, {{1.000000, 0.000000, 0.000000}}},
        {{{1.000000, -1.000000, -1.000000}},  {{0.375000, 0.750000}}, {{1.000000, 0.000000, 0.000000}}},
        {{{1.000000, -1.000000, -1.000000}},  {{0.375000, 0.750000}}, {{0.000000, -1.000000, 0.000000}}},
        {{{1.000000, -1.000000, 1.000000}},   {{0.625000, 0.750000}}, {{0.000000, -1.000000, 0.000000}}},
        {{{-1.000000, -1.000000, 1.000000}},  {{0.625000, 1.000000}}, {{0.000000, -1.000000, 0.000000}}},
        {{{-1.000000, -1.000000, -1.000000}}, {{0.375000, 1.000000}}, {{0.000000, -1.000000, 0.000000}}},
        {{{-1.000000, 1.000000, -1.000000}},  {{0.125000, 0.500000}}, {{0.000000, 0.000000, -1.000000}}},
        {{{1.000000, 1.000000, -1.000000}},   {{0.375000, 0.500000}}, {{0.000000, 0.000000, -1.000000}}},
        {{{1.000000, -1.000000, -1.000000}},  {{0.375000, 0.750000}}, {{0.000000, 0.000000, -1.000000}}},
        {{{-1.000000, -1.000000, -1.000000}}, {{0.125000, 0.750000}}, {{0.000000, 0.000000, -1.000000}}},
        {{{1.000000, 1.000000, 1.000000}},   {{0.625000, 0.500000}},  {{0.000000, 0.000000, 1.000000}}},
        {{{-1.000000, 1.000000, 1.000000}},   {{0.875000, 0.500000}}, {{0.000000, 0.000000, 1.000000}}},
        {{{-1.000000, -1.000000, 1.000000}},  {{0.875000, 0.750000}}, {{0.000000, 0.000000, 1.000000}}},
        {{{1.000000, -1.000000, 1.000000}},   {{0.625000, 0.750000}}, {{0.000000, 0.000000, 1.000000}}},
    };

    u32 indices[] = 
    {   
        0, 1, 2, 0, 2, 3, 4, 5, 6, 4, 6, 7, 8, 9, 10, 8, 10, 11, 12, 13, 14, 12, 14, 15, 16, 17, 
        18, 16, 18, 19, 20, 21, 22, 20, 22, 23
    };
    
    for (u32 i = 0; i < ARRAY_SIZE(verts); i++)
    {
        fe_vertex_t *v = NULL;
        fe_vec_add_and_get(cube->verts, v);
        *v = verts[i];
    }

    for (u32 i = 0; i < ARRAY_SIZE(indices); i++)
    {
        u32 *indice = NULL;
        fe_vec_add_and_get(cube->indices, indice);
        *indice = indices[i];
    }
}

void
fe_mesh_make_sphere(fe_mesh_t *sphere)
{
    fe_mesh_make(sphere);
    fe_vertex_t verts[] = 
    {
        { {{0.000000, 1.000000, 0.000000}},       {{0.750000, 0.500000}},       {{0.000000, 1.000000, 0.000000}} },      
        { {{0.000000, 0.923874, 0.382675}},       {{0.750000, 0.625000}},       {{0.000000, 0.930298, 0.366791}}},      
        { {{0.653275, 0.653275, 0.382675}},       {{0.625000, 0.625000}},       {{0.657791, 0.657791, 0.366791}}},      
        { {{0.707092, 0.707092, 0.000000}},       {{0.625000, 0.500000}},       {{0.707092, 0.707092, 0.000000}}},      
        { {{0.000000, 0.707092, 0.707092}},       {{0.750000, 0.750000}},       {{0.000000, 0.729599, 0.683792}}},      
        { {{0.000000, 0.382675, 0.923874}},       {{0.750000, 0.875000}},       {{0.000000, 0.422592, 0.906296}}},      
        { {{0.270584, 0.270584, 0.923874}},       {{0.625000, 0.875000}},       {{0.298798, 0.298798, 0.906296}}},      
        { {{0.500000, 0.500000, 0.707092}},       {{0.625000, 0.750000}},       {{0.515900, 0.515900, 0.683792}}},      
        { {{0.000000, 0.382675, -0.923874}},      { {0.750000, 0.125000}},      { {0.000000, 0.422592, -0.906296}}},      
        { {{0.000000, 0.707092, -0.707092}},      { {0.750000, 0.250000}},      { {0.000000, 0.729599, -0.683792}}},      
        { {{0.500000, 0.500000, -0.707092}},      { {0.625000, 0.250000}},      { {0.515900, 0.515900, -0.683792}}},      
        { {{0.270584, 0.270584, -0.923874}},      { {0.625000, 0.125000}},      { {0.298798, 0.298798, -0.906296}}},      
        { {{0.000000, 0.923874, -0.382675}},      { {0.750000, 0.375000}},      { {0.000000, 0.930298, -0.366791}}},      
        { {{0.653275, 0.653275, -0.382675}},      { {0.625000, 0.375000}},      { {0.657791, 0.657791, -0.366791}}},      
        { {{0.000000, 0.707092, 0.707092}},       {{0.750000, 0.750000}},       {{0.000000, 0.729599, 0.683792}}},      
        { {{0.500000, 0.500000, 0.707092}},       {{0.625000, 0.750000}},       {{0.515900, 0.515900, 0.683792}}},      
        { {{0.000000, 0.000000, 1.000000}},       {{0.687500, 1.000000}},       {{0.000000, 0.000000, 1.000000}}},      
        { {{0.000000, 0.000000, -1.000000}},      { {0.687500, 0.000000}},      { {0.000000, 0.000000, -1.000000}}},      
        { {{0.000000, 0.707092, -0.707092}},      { {0.750000, 0.250000}},      { {0.000000, 0.729599, -0.683792}}},      
        { {{0.500000, 0.500000, -0.707092}},      { {0.625000, 0.250000}},      { {0.515900, 0.515900, -0.683792}}},      
        { {{0.500000, 0.500000, -0.707092}},      { {0.625000, 0.250000}},      { {0.515900, 0.515900, -0.683792}}},      
        { {{0.707092, 0.000000, -0.707092}},      { {0.500000, 0.250000}},      { {0.729599, 0.000000, -0.683792}}},      
        { {{0.382675, 0.000000, -0.923874}},      { {0.500000, 0.125000}},      { {0.422592, 0.000000, -0.906296}}},      
        { {{1.000000, 0.000000, 0.000000}},       {{0.500000, 0.500000}},       {{1.000000, 0.000000, 0.000000}}},      
        { {{0.923874, 0.000000, -0.382675}},      { {0.500000, 0.375000}},      { {0.930298, 0.000000, -0.366791}}},      
        { {{0.500000, 0.500000, 0.707092}},       {{0.625000, 0.750000}},       {{0.515900, 0.515900, 0.683792}}},      
        { {{0.707092, 0.000000, 0.707092}},       {{0.500000, 0.750000}},       {{0.729599, 0.000000, 0.683792}}},      
        { {{0.923874, 0.000000, 0.382675}},       {{0.500000, 0.625000}},       {{0.930298, 0.000000, 0.366791}}},      
        { {{0.000000, 0.000000, 1.000000}},       {{0.562500, 1.000000}},       {{0.000000, 0.000000, 1.000000}}},      
        { {{0.382675, 0.000000, 0.923874}},       {{0.500000, 0.875000}},       {{0.422592, 0.000000, 0.906296}}},      
        { {{0.000000, 0.000000, -1.000000}},      { {0.562500, 0.000000}},      { {0.000000, 0.000000, -1.000000}}},      
        { {{0.500000, 0.500000, -0.707092}},      { {0.625000, 0.250000}},      { {0.515900, 0.515900, -0.683792}}},      
        { {{0.707092, 0.000000, -0.707092}},      { {0.500000, 0.250000}},      { {0.729599, 0.000000, -0.683792}}},      
        { {{0.500000, 0.500000, 0.707092}},       {{0.625000, 0.750000}},       {{0.515900, 0.515900, 0.683792}}},      
        { {{0.707092, 0.000000, 0.707092}},       {{0.500000, 0.750000}},       {{0.729599, 0.000000, 0.683792}}},      
        { {{0.000000, 0.000000, 1.000000}},       {{0.437500, 1.000000}},       {{0.000000, 0.000000, 1.000000}}},      
        { {{0.270584, -0.270584, 0.923874}},      { {0.375000, 0.875000}},      { {0.298798, -0.298798, 0.906296}}},      
        { {{0.000000, 0.000000, -1.000000}},      { {0.437500, 0.000000}},      { {0.000000, 0.000000, -1.000000}}},      
        { {{0.270584, -0.270584, -0.923874}},     {  {0.375000, 0.125000}},     {  {0.298798, -0.298798, -0.906296}}},      
        { {{0.707092, 0.000000, -0.707092}},      { {0.500000, 0.250000}},      { {0.729599, 0.000000, -0.683792}}},      
        { {{0.653275, -0.653275, -0.382675}},     {  {0.375000, 0.375000}},     {  {0.657791, -0.657791, -0.366791}}},      
        { {{0.500000, -0.500000, -0.707092}},     {  {0.375000, 0.250000}},     {  {0.515900, -0.515900, -0.683792}}},      
        { {{0.653275, -0.653275, 0.382675}},      { {0.375000, 0.625000}},      { {0.657791, -0.657791, 0.366791}}},      
        { {{0.707092, -0.707092, 0.000000}},      { {0.375000, 0.500000}},      { {0.707092, -0.707092, 0.000000}}},      
        { {{0.707092, 0.000000, 0.707092}},       {{0.500000, 0.750000}},       {{0.729599, 0.000000, 0.683792}}},      
        { {{0.500000, -0.500000, 0.707092}},      { {0.375000, 0.750000}},      { {0.515900, -0.515900, 0.683792}}},      
        { {{0.707092, 0.000000, -0.707092}},      { {0.500000, 0.250000}},      { {0.729599, 0.000000, -0.683792}}},      
        { {{0.500000, -0.500000, -0.707092}},     {  {0.375000, 0.250000}},     {  {0.515900, -0.515900, -0.683792}}},      
        { {{0.707092, 0.000000, 0.707092}},       {{0.500000, 0.750000}},       {{0.729599, 0.000000, 0.683792}}},      
        { {{0.500000, -0.500000, 0.707092}},      { {0.375000, 0.750000}},      { {0.515900, -0.515900, 0.683792}}},      
        { {{0.500000, -0.500000, -0.707092}},     {  {0.375000, 0.250000}},     {  {0.515900, -0.515900, -0.683792}}},      
        { {{0.000000, -0.923874, -0.382675}},     {  {0.250000, 0.375000}},     {  {0.000000, -0.930298, -0.366791}}},      
        { {{0.000000, -0.707092, -0.707092}},     {  {0.250000, 0.250000}},     {  {0.000000, -0.729599, -0.683792}}},      
        { {{0.000000, -0.923874, 0.382675}},      { {0.250000, 0.625000}},      { {0.000000, -0.930298, 0.366791}}},      
        { {{0.000000, -1.000000, 0.000000}},      { {0.250000, 0.500000}},      { {0.000000, -1.000000, 0.000000}}},      
        { {{0.500000, -0.500000, 0.707092}},      { {0.375000, 0.750000}},      { {0.515900, -0.515900, 0.683792}}},      
        { {{0.000000, -0.382675, 0.923874}},      { {0.250000, 0.875000}},      { {0.000000, -0.422592, 0.906296}}},      
        { {{0.000000, -0.707092, 0.707092}},      { {0.250000, 0.750000}},      { {0.000000, -0.729599, 0.683792}}},      
        { {{0.270584, -0.270584, -0.923874}},     {  {0.375000, 0.125000}},     {  {0.298798, -0.298798, -0.906296}}},      
        { {{0.500000, -0.500000, -0.707092}},     {  {0.375000, 0.250000}},     {  {0.515900, -0.515900, -0.683792}}},      
        { {{0.000000, -0.707092, -0.707092}},     {  {0.250000, 0.250000}},     {  {0.000000, -0.729599, -0.683792}}},      
        { {{0.000000, -0.382675, -0.923874}},     {  {0.250000, 0.125000}},     {  {0.000000, -0.422592, -0.906296}}},      
        { {{0.500000, -0.500000, 0.707092}},      { {0.375000, 0.750000}},      { {0.515900, -0.515900, 0.683792}}},      
        { {{0.000000, -0.707092, 0.707092}},      { {0.250000, 0.750000}},      { {0.000000, -0.729599, 0.683792}}},      
        { {{0.000000, 0.000000, 1.000000}},       {{0.312500, 1.000000}},       {{0.000000, 0.000000, 1.000000}}},      
        { {{0.000000, 0.000000, -1.000000}},      { {0.312500, 0.000000}},      { {0.000000, 0.000000, -1.000000}}},      
        { {{0.000000, -0.707092, -0.707092}},     {  {0.250000, 0.250000}},     {  {0.000000, -0.729599, -0.683792}}},      
        { {{-0.500000, -0.500000, -0.707092}},    {   {0.125000, 0.25000}},     {  {-0.515900, -0.515900, -0.683792}}},      
        { {{-0.270584, -0.270584, -0.923874}},    {   {0.125000, 0.12500}},     {  {-0.298798, -0.298798, -0.906296}}},      
        { {{-0.707092, -0.707092, 0.000000}},     {  {0.125000, 0.500000}},     {  {-0.707092, -0.707092, 0.000000}}},      
        { {{-0.653275, -0.653275, -0.382675}},    {   {0.125000, 0.37500}},     {  {-0.657791, -0.657791, -0.366791}}},      
        { {{0.000000, -0.707092, 0.707092}},      { {0.250000, 0.750000}},      { {0.000000, -0.729599, 0.683792}}},      
        { {{-0.500000, -0.500000, 0.707092}},     {  {0.125000, 0.750000}},     {  {-0.515900, -0.515900, 0.683792}}},      
        { {{-0.653275, -0.653275, 0.382675}},     {  {0.125000, 0.625000}},     {  {-0.657791, -0.657791, 0.366791}}},      
        { {{0.000000, 0.000000, 1.000000}},       {{0.187500, 1.000000}},       {{0.000000, 0.000000, 1.000000}}},      
        { {{-0.270584, -0.270584, 0.923874}},     {  {0.125000, 0.875000}},     {  {-0.298798, -0.298798, 0.906296}}},      
        { {{0.000000, 0.000000, -1.000000}},      { {0.187500, 0.000000}},      { {0.000000, 0.000000, -1.000000}}},      
        { {{0.000000, -0.707092, -0.707092}},     {  {0.250000, 0.250000}},     {  {0.000000, -0.729599, -0.683792}}},      
        { {{-0.500000, -0.500000, -0.707092}},    {   {0.125000, 0.25000}},     {  {-0.515900, -0.515900, -0.683792}}},      
        { {{0.000000, -0.707092, 0.707092}},      { {0.250000, 0.750000}},      { {0.000000, -0.729599, 0.683792}}},      
        { {{-0.500000, -0.500000, 0.707092}},     {  {0.125000, 0.750000}},     {  {-0.515900, -0.515900, 0.683792}}},      
        { {{-1.000000, 0.000000, 0.000000}},      { {0.000000, 0.500000}},      { {-1.000000, 0.000000, 0.000000}}},      
        { {{-0.923874, 0.000000, -0.382675}},     {  {0.000000, 0.375000}},     {  {-0.930298, 0.000000, -0.366791}}},      
        { {{-0.500000, -0.500000, 0.707092}},     {  {0.125000, 0.750000}},     {  {-0.515900, -0.515900, 0.683792}}},      
        { {{-0.707092, 0.000000, 0.707092}},      { {0.000000, 0.750000}},      { {-0.729599, 0.000000, 0.683792}}},      
        { {{-0.923874, 0.000000, 0.382675}},      { {0.000000, 0.625000}},      { {-0.930298, 0.000000, 0.366791}}},      
        { {{0.000000, 0.000000, 1.000000}},       {{0.062500, 1.000000}},       {{0.000000, 0.000000, 1.000000}}},      
        { {{-0.382675, 0.000000, 0.923874}},      { {0.000000, 0.875000}},      { {-0.422592, 0.000000, 0.906296}}},      
        { {{0.000000, 0.000000, -1.000000}},      { {0.062500, 0.000000}},      { {0.000000, 0.000000, -1.000000}}},      
        { {{-0.382675, 0.000000, -0.923874}},     {  {0.000000, 0.125000}},     {  {-0.422592, 0.000000, -0.906296}}},      
        { {{-0.500000, -0.500000, -0.707092}},    {   {0.125000, 0.25000}},      { {-0.515900, -0.515900, -0.683792}}},      
        { {{-0.707092, 0.000000, -0.707092}},     {  {0.000000, 0.250000}},     {  {-0.729599, 0.000000, -0.683792}}},      
        { {{-0.500000, -0.500000, 0.707092}},     {  {0.125000, 0.750000}},     {  {-0.515900, -0.515900, 0.683792}}},      
        { {{-0.707092, 0.000000, 0.707092}},      { {0.000000, 0.750000}},      { {-0.729599, 0.000000, 0.683792}}},      
        { {{-0.500000, -0.500000, -0.707092}},    {   {0.125000, 0.25000}},     {  {-0.515900, -0.515900, -0.683792}}},      
        { {{-0.707092, 0.000000, -0.707092}},     {  {0.000000, 0.250000}},     {  {-0.729599, 0.000000, -0.683792}}},      
        { {{0.000000, 0.000000, -1.000000}},      { {0.937500, 0.000000}},      { {0.000000, 0.000000, -1.000000}}},      
        { {{-0.382675, 0.000000, -0.923874}},     {  {1.000000, 0.125000}},     {  {-0.422592, 0.000000, -0.906296}}},      
        { {{-0.270584, 0.270584, -0.923874}},     {  {0.875000, 0.125000}},     {  {-0.298798, 0.298798, -0.906292}}},      
        { {{-0.707092, 0.000000, -0.707092}},     {  {1.000000, 0.250000}},     {  {-0.729599, 0.000000, -0.683792}}},      
        { {{-0.923874, 0.000000, -0.382675}},     {  {1.000000, 0.375000}},     {  {-0.930298, 0.000000, -0.366791}}},      
        { {{-0.653275, 0.653275, -0.382675}},     {  {0.875000, 0.375000}},     {  {-0.657791, 0.657791, -0.366791}}},      
        { {{-0.500000, 0.500000, -0.707092}},     {  {0.875000, 0.250000}},     {  {-0.515900, 0.515900, -0.683792}}},      
        { {{-1.000000, 0.000000, 0.000000}},      { {1.000000, 0.500000}},      { {-1.000000, 0.000000, 0.000000}}},      
        { {{-0.923874, 0.000000, 0.382675}},      { {1.000000, 0.625000}},      { {-0.930298, 0.000000, 0.366791}}},      
        { {{-0.653275, 0.653275, 0.382675}},      { {0.875000, 0.625000}},      { {-0.657791, 0.657791, 0.366791}}},      
        { {{-0.707092, 0.707092, 0.000000}},      { {0.875000, 0.500000}},      { {-0.707092, 0.707092, 0.000000}}},      
        { {{-0.707092, 0.000000, 0.707092}},      { {1.000000, 0.750000}},      { {-0.729599, 0.000000, 0.683792}}},      
        { {{-0.382675, 0.000000, 0.923874}},      { {1.000000, 0.875000}},      { {-0.422592, 0.000000, 0.906296}}},      
        { {{-0.270584, 0.270584, 0.923874}},      { {0.875000, 0.875000}},      { {-0.298798, 0.298798, 0.906296}}},      
        { {{-0.500000, 0.500000, 0.707092}},      { {0.875000, 0.750000}},      { {-0.515900, 0.515900, 0.683792}}},      
        { {{-0.382675, 0.000000, -0.923874}},     {  {1.000000, 0.125000}},     {  {-0.422592, 0.000000, -0.906296}}},      
        { {{-0.707092, 0.000000, -0.707092}},     {  {1.000000, 0.250000}},     {  {-0.729599, 0.000000, -0.683792}}},      
        { {{-0.500000, 0.500000, -0.707092}},     {  {0.875000, 0.250000}},     {  {-0.515900, 0.515900, -0.683792}}},      
        { {{-0.707092, 0.000000, 0.707092}},      { {1.000000, 0.750000}},      { {-0.729599, 0.000000, 0.683792}}},      
        { {{-0.500000, 0.500000, 0.707092}},      { {0.875000, 0.750000}},      { {-0.515900, 0.515900, 0.683792}}},      
        { {{0.000000, 0.000000, 1.000000}},       {{0.937500, 1.000000}},       {{0.000000, 0.000000, 1.000000}}},      
        { {{-0.500000, 0.500000, 0.707092}},      { {0.875000, 0.750000}},      { {-0.515900, 0.515900, 0.683792}}},      
        { {{0.000000, 0.707092, 0.707092}},       {{0.750000, 0.750000}},       {{0.000000, 0.729599, 0.683792}}},      
        { {{-0.270584, 0.270584, -0.923874}},     {  {0.875000, 0.125000}},     {  {-0.298798, 0.298798, -0.906296}}},      
        { {{-0.500000, 0.500000, -0.707092}},     {  {0.875000, 0.250000}},     {  {-0.515900, 0.515900, -0.683792}}},      
        { {{0.000000, 0.707092, -0.707092}},      { {0.750000, 0.250000}},      { {0.000000, 0.729599, -0.683792}}},      
        { {{-0.500000, 0.500000, 0.707092}},      { {0.875000, 0.750000}},      { {-0.515900, 0.515900, 0.683792}}},      
        { {{0.000000, 0.707092, 0.707092}},       {{0.750000, 0.750000}},       {{0.000000, 0.729599, 0.683792}}},      
        { {{0.000000, 0.000000, 1.000000}},       {{0.812500, 1.000000}},       {{0.000000, 0.000000, 1.000000}}},      
        { {{0.000000, 0.000000, -1.000000}},      { {0.812500, 0.000000}},      { {0.000000, 0.000000, -1.000000}}},      
        { {{0.000000, 0.382675, -0.923874}},      { {0.750000, 0.125000}},      { {0.000000, 0.422592, -0.906296}}},      
        { {{-0.500000, 0.500000, -0.707092}},     {  {0.875000, 0.250000}},     {  {-0.515900, 0.515900, -0.683792}}},      
        { {{0.000000, 0.707092, -0.707092}},      { {0.750000, 0.250000}},      { {0.000000, 0.729599, -0.683792}}},      
    };

    u32 indices[] = 
    {   
        0, 1, 2, 0, 2, 3, 12, 0, 3, 106, 1, 0, 101, 106, 0, 101, 0, 12, 12, 3, 13, 13, 3, 23, 3, 2, 27, 3, 27, 23, 
        18, 12, 13, 127, 101, 12, 127, 12, 128, 18, 13, 19, 13, 23, 24, 31, 13, 24, 31, 24, 32, 39, 24, 40, 24, 23, 
        43, 24, 43, 40, 39, 40, 41, 50, 40, 51, 40, 43, 54, 40, 54, 51, 23, 42, 43, 43, 42, 53, 43, 53, 54, 51, 54, 
        69, 54, 53, 73, 54, 73, 69, 42, 63, 53, 53, 71, 72, 53, 72, 73, 73, 83, 84, 73, 84, 85, 69, 73, 85, 69, 85, 
        81, 70, 69, 81, 70, 81, 82, 51, 69, 70, 77, 51, 70, 77, 70, 78, 90, 70, 82, 90, 82, 91, 50, 51, 52, 42, 62, 
        63, 23, 27, 42, 27, 49, 42, 2, 26, 27, 27, 48, 49, 1, 15, 2, 2, 25, 26, 1, 14, 15, 106, 105, 1, 105, 123, 1, 
        103, 105, 106, 100, 103, 106, 100, 106, 101, 103, 104, 105, 104, 115, 105, 105, 122, 123, 104, 114, 115, 99,
        100, 101, 99, 101, 102, 4, 5, 6, 4, 6, 7, 5, 16, 6, 117, 109, 5, 117, 5, 118, 109, 124, 5, 6, 28, 29, 33, 6, 
        29, 33, 29, 34, 29, 35, 36, 44, 29, 36, 44, 36, 45, 55, 36, 56, 36, 64, 56, 55, 56, 57, 56, 74, 75, 79, 56, 
        75, 79, 75, 80, 75, 86, 87, 92, 75, 87, 92, 87, 93, 107, 108, 109, 107, 109, 110, 108, 116, 109, 8, 9, 10, 8, 
        10, 11, 17, 8, 11, 119, 121, 8, 11, 20, 21, 11, 21, 22, 30, 11, 22, 37, 22, 38, 22, 46, 47, 22, 47, 38, 65, 
        38, 61, 58, 60, 61, 61, 66, 67, 61, 67, 68, 76, 61, 68, 58, 59, 60, 88, 68, 89, 68, 94, 95, 68, 95, 89, 119, 
        120, 121, 96, 97, 98, 111, 113, 98, 125, 98, 126, 111, 112, 113,
    };
    
    for (u32 i = 0; i < ARRAY_SIZE(verts); i++)
    {
        fe_vertex_t *v = NULL;
        fe_vec_add_and_get(sphere->verts, v);
        *v = verts[i];
    }

    for (u32 i = 0; i < ARRAY_SIZE(indices); i++)
    {
        u32 *indice = NULL;
        fe_vec_add_and_get(sphere->indices, indice);
        *indice = indices[i];
    }
}

void
fe_mesh_make_cylinder(fe_mesh_t *cylinder)
{
    fe_mesh_make(cylinder);
    fe_vertex_t verts[] = 
    {
        { {{0.000000, 1.000000, -1.000000}},    { {1.000000, 0.500000}},    { {0.000000, 0.776398, -0.630188}}},    
        { {{0.000000, 1.000000, 1.000000}},     {{1.000000, 1.000000}},     {{0.000000, 0.776398, 0.630188}}},    
        { {{0.707092, 0.707092, 1.000000}},     {{0.875000, 1.000000}},     {{0.548996, 0.548996, 0.630188}}},    
        { {{0.707092, 0.707092, -1.000000}},    { {0.875000, 0.500000}},    { {0.548996, 0.548996, -0.630188}}},    
        { {{1.000000, 0.000000, 1.000000}},     {{0.750000, 1.000000}},     {{0.776398, 0.000000, 0.630188}}},    
        { {{1.000000, 0.000000, -1.000000}},    { {0.750000, 0.500000}},    { {0.776398, 0.000000, -0.630188}}},    
        { {{0.707092, -0.707092, 1.000000}},    { {0.625000, 1.000000}},    { {0.548996, -0.548996, 0.630188}}},    
        { {{0.707092, -0.707092, -1.000000}},   {  {0.625000, 0.500000}},   {  {0.548996, -0.548996, -0.630188}}},    
        { {{0.000000, -1.000000, 1.000000}},    { {0.500000, 1.000000}},    { {0.000000, -0.776398, 0.630188}}},    
        { {{0.000000, -1.000000, -1.000000}},   {  {0.500000, 0.500000}},   {  {0.000000, -0.776398, -0.630188}}},    
        { {{-0.707092, -0.707092, 1.000000}},   {  {0.375000, 1.000000}},   {  {-0.548996, -0.548996, 0.630188}}},    
        { {{-0.707092, -0.707092, -1.000000}},  {   {0.375000, 0.500000}},  {   {-0.548996, -0.548996, -0.630188}}},    
        { {{-1.000000, 0.000000, 1.000000}},    { {0.250000, 1.000000}},    { {-0.776398, 0.000000, 0.630188}}},    
        { {{-1.000000, 0.000000, -1.000000}},   {  {0.250000, 0.500000}},   {  {-0.776398, 0.000000, -0.630188}}},    
        { {{0.707092, 0.707092, 1.000000}},     {{0.419693, 0.419693}},     {{0.548996, 0.548996, 0.630188}}},    
        { {{0.000000, 1.000000, 1.000000}},     {{0.250000, 0.489990}},     {{0.000000, 0.776398, 0.630188}}},    
        { {{-0.707092, 0.707092, 1.000000}},    { {0.080292, 0.419693}},    { {-0.548996, 0.548996, 0.630188}}},    
        { {{-1.000000, 0.000000, 1.000000}},    { {0.009995, 0.250000}},    { {-0.776398, 0.000000, 0.630188}}},    
        { {{-0.707092, -0.707092, 1.000000}},   {  {0.080292, 0.080292}},   {  {-0.548996, -0.548996, 0.630188}}},    
        { {{0.000000, -1.000000, 1.000000}},    { {0.250000, 0.009995}},    { {0.000000, -0.776398, 0.630188}}},    
        { {{0.707092, -0.707092, 1.000000}},    { {0.419693, 0.080292}},    { {0.548996, -0.548996, 0.630188}}},    
        { {{1.000000, 0.000000, 1.000000}},     {{0.489990, 0.250000}},     {{0.776398, 0.000000, 0.630188}}},    
        { {{-0.707092, 0.707092, 1.000000}},    { {0.125000, 1.000000}},    { {-0.548996, 0.548996, 0.630188}}},    
        { {{-0.707092, 0.707092, -1.000000}},   {  {0.125000, 0.500000}},   {  {-0.548996, 0.548996, -0.630188}}},    
        { {{0.000000, 1.000000, 1.000000}},     {{0.000000, 1.000000}},     {{0.000000, 0.776398, 0.630188}}},    
        { {{0.000000, 1.000000, -1.000000}},    { {0.000000, 0.500000}},    { {0.000000, 0.776398, -0.630188}}},    
        { {{0.000000, 1.000000, -1.000000}},    { {0.750000, 0.489990}},    { {0.000000, 0.776398, -0.630188}}},    
        { {{0.707092, 0.707092, -1.000000}},    { {0.919693, 0.419693}},    { {0.548996, 0.548996, -0.630188}}},    
        { {{1.000000, 0.000000, -1.000000}},    { {0.989990, 0.250000}},    { {0.776398, 0.000000, -0.630188}}},    
        { {{0.707092, -0.707092, -1.000000}},   {  {0.919693, 0.080292}},   {  {0.548996, -0.548996, -0.630188}}},    
        { {{0.000000, -1.000000, -1.000000}},   {  {0.750000, 0.009995}},   {  {0.000000, -0.776398, -0.630188}}},    
        { {{-0.707092, -0.707092, -1.000000}},  {   {0.580292, 0.080292}},  {   {-0.548996, -0.548996, -0.630188}}},    
        { {{-1.000000, 0.000000, -1.000000}},   {  {0.509995, 0.250000}},   {  {-0.776398, 0.000000, -0.630188}}},    
        { {{-0.707092, 0.707092, -1.000000}},   {  {0.580292, 0.419693}},   {  {-0.548996, 0.548996, -0.630188}}},    
    };

    u32 indices[] = 
    {
        0, 1, 2, 0, 2, 3, 3, 2, 4, 3, 4, 5, 5, 4, 6, 5, 6, 7, 7, 6, 8, 7, 8, 9, 9, 8, 10, 9, 10, 11, 11, 10, 12, 11, 
        12, 13, 13, 12, 22, 13, 22, 23, 23, 22, 24, 23, 24, 25, 21, 14, 15, 21, 15, 16, 21, 16, 17, 21, 17, 18, 21, 
        18, 19, 19, 20, 21, 33, 26, 27, 33, 27, 28, 33, 28, 29, 33, 29, 30, 33, 30, 31, 31, 32, 33
    };
    
    for (u32 i = 0; i < ARRAY_SIZE(verts); i++)
    {
        fe_vertex_t *v = NULL;
        fe_vec_add_and_get(cylinder->verts, v);
        *v = verts[i];
    }

    for (u32 i = 0; i < ARRAY_SIZE(indices); i++)
    {
        u32 *indice = NULL;
        fe_vec_add_and_get(cylinder->indices, indice);
        *indice = indices[i];
    }
}
